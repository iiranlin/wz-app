(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c03e4722"],{"4df3":function(e,t,i){},"5b81":function(e,t,i){"use strict";var n=i("23e7"),a=i("c65b"),s=i("e330"),r=i("1d80"),o=i("1626"),c=i("7234"),u=i("44e7"),d=i("577e"),l=i("dc4a"),h=i("90d8"),f=i("0cb2"),g=i("b622"),p=i("c430"),v=g("replace"),m=TypeError,b=s("".indexOf),O=s("".replace),w=s("".slice),L=Math.max;n({target:"String",proto:!0},{replaceAll:function(e,t){var i,n,s,g,D,I,j,y,A,k,x=r(this),S=0,T="";if(!c(e)){if(i=u(e),i&&(n=d(r(h(e))),!~b(n,"g")))throw new m("`.replaceAll` does not allow non-global regexes");if(s=l(e,v),s)return a(s,e,x,t);if(p&&i)return O(d(x),e,t)}g=d(x),D=d(e),I=o(t),I||(t=d(t)),j=D.length,y=L(1,j),A=b(g,D);while(-1!==A)k=I?d(t(D,A,g)):f(D,g,A,[],void 0,t),T+=w(g,S,A)+k,S=A+j,A=A+y>g.length?-1:b(g,D,A+y);return S<g.length&&(T+=w(g,S)),T}})},"986e":function(e,t,i){"use strict";var n=i("2b0e"),a=new n["d"]({});t["a"]=a},b97f:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"main-container"},[t("general-order-detail",{attrs:{orderDetail:e.orderDetail,approveLogList:e.approveLogList,hasButton:"1"==e.orderDetail.status||"2"==e.orderDetail.status}}),"1"==e.orderDetail.status||"2"==e.orderDetail.status?t("div",{staticClass:"default-button-container-two"},[t("van-button",{attrs:{block:"",type:"default",round:""},on:{click:function(t){return e.handleReject()}}},[e._v("驳回")]),t("van-button",{attrs:{block:"",type:"info",round:""},on:{click:function(t){return e.handleAdopt()}}},[e._v("通过")])],1):e._e(),t("van-popup",{attrs:{position:"bottom"},model:{value:e.assigneeShow,callback:function(t){e.assigneeShow=t},expression:"assigneeShow"}},[t("div",{staticClass:"popup-title"},[t("span",[e._v("请选择下一级审批人")]),t("van-button",{staticClass:"more-button",attrs:{type:"info",size:"small","native-type":"button"},on:{click:e.handleMoreClick}},[e._v("更多审核人")])],1),t("van-search",{attrs:{placeholder:"请输入审批人姓名"},on:{search:e.onSearch,clear:e.onSearch},model:{value:e.assigneeSearchText,callback:function(t){e.assigneeSearchText=t},expression:"assigneeSearchText"}}),t("van-tree-select",{attrs:{"active-id":e.candidateUser,"main-active-index":e.activeIndex,items:e.assigneeList},on:{"update:activeId":function(t){e.candidateUser=t},"update:active-id":function(t){e.candidateUser=t},"update:mainActiveIndex":function(t){e.activeIndex=t},"update:main-active-index":function(t){e.activeIndex=t}}}),t("van-button",{staticClass:"van-button-sure",on:{click:e.handleTreeSelect}},[e._v("确定")])],1)],1)},a=[],s=(i("4de4"),i("4160"),i("caad"),i("14d9"),i("d3b7"),i("2532"),i("0643"),i("2382"),i("4e3e"),i("159b"),i("f8b7")),r=i("8a60"),o=i("986e"),c=i("fd99"),u={name:"ApprovalDetail",mixins:[c["a"]],components:{GeneralOrderDetail:r["a"]},data:function(){return{id:"",orderDetail:{},approveLogList:[],assigneeShow:!1,originAssigneeList:[],assigneeList:[],candidateUser:[],assigneeSearchText:"",showMore:!1,activeIndex:0}},created:function(){this.id=this.$route.params.id,this.getOrderDetail(),this.getOrderApprovalLog(),o["a"].$off("rejectConfirm"),o["a"].$on("rejectConfirm",function(e){this.requestReject(e)}.bind(this))},activated:function(){this.$route.params.refresh&&(this.getOrderDetail(),this.getOrderApprovalLog())},methods:{getOrderDetail:function(){var e=this,t=this.$toast.loading({duration:0,message:"加载中..",forbidClick:!0}),i={id:this.id};Object(s["e"])(i).then((function(t){var i=t.data;e.orderDetail=i.list[0]})).catch((function(){})).finally((function(){t.clear()}))},getOrderApprovalLog:function(){var e=this,t=this.$toast.loading({duration:0,message:"加载中..",forbidClick:!0}),i={reqId:this.id};Object(s["i"])(i).then((function(t){var i=t.data;e.approveLogList=i})).catch((function(){})).finally((function(){t.clear()}))},handleAdopt:function(){var e=this,t=this.$toast.loading({duration:0,message:"正在加载..",forbidClick:!0}),i={businessId:this.id,procDefId:"",procInstId:this.orderDetail.procInstId,actId:this.orderDetail.actId};Object(s["b"])(i).then((function(t){var i=t.data;if(i.assignee)e.candidateUser.push(i.assignee),e.showAgreeApprovalOrderDialog();else if(i.assigneeList&&i.assigneeList.length>0){e.originAssigneeList=e.getTreeData(i.assigneeList);var n=i.assigneeList.filter((function(e){return"0"===e.hide}));e.assigneeList=e.getTreeData(n),e.assigneeShow=!0,e.showMore=!1}else e.showAgreeApprovalOrderDialog()})).catch((function(e){})).finally((function(){t.clear()}))},getTreeData:function(e){var t=[];return t.push({text:"",children:[]}),e.forEach((function(e){t[0].children.push({text:e.name||e.text,id:e.code||e.id,hide:e.hide})})),t},handleMoreClick:function(){this.assigneeList=this.originAssigneeList,this.showMore=!0},handleTreeSelect:function(){this.candidateUser&&this.showAgreeApprovalOrderDialog(),this.assigneePopupShow=!1},showAgreeApprovalOrderDialog:function(){var e=this;this.$dialog.confirm({title:"提示",message:"是否要审批通过?"}).then((function(){e.approvalOrderApi()})).catch((function(){}))},approvalOrderApi:function(){var e=this,t=this.$toast.loading({duration:0,message:"正在提交审批..",forbidClick:!0}),i={businessId:this.id,procInstId:this.orderDetail.procInstId,comment:"同意",taskId:this.orderDetail.taskId,candidateUser:this.candidateUser};Object(s["d"])(i).then((function(t){var i=t.message;e.$notify({type:"success",message:i}),e.$router.push({name:"ApprovalSuccess",params:{id:e.id}})})).catch((function(t){e.$toast.fail("审批失败!")})).finally((function(){t.clear()}))},handleReject:function(){this.$router.push({name:"RejectEdit",params:{}})},requestReject:function(e){var t=this,i=this.$toast.loading({duration:0,message:"正在驳回..",forbidClick:!0}),n={comment:e,status:"1",businessId:this.id,procInstId:this.orderDetail.procInstId,taskId:this.orderDetail.taskId};Object(s["n"])(n).then((function(e){var i=e.message;t.$notify({type:"success",message:i}),t.$router.push({name:"ApprovalSuccess",params:{id:t.id}})})).catch((function(e){t.$toast.fail("驳回失败!")})).finally((function(){i.clear()}))},onSearch:function(){var e=this;if(this.assigneeSearchText){var t=this.assigneeList[0].children.filter((function(t){return t.text.includes(e.assigneeSearchText)}));this.assigneeList=this.getTreeData(t)}else if(this.showMore)this.assigneeList=this.originAssigneeList;else{var i=this.originAssigneeList[0].children.filter((function(e){return"0"==e.hide}));this.assigneeList=this.getTreeData(i)}}}},d=u,l=(i("fe58"),i("2877")),h=Object(l["a"])(d,n,a,!1,null,"25c6e4c4",null);t["default"]=h.exports},f8b7:function(e,t,i){"use strict";i.d(t,"l",(function(){return a})),i.d(t,"m",(function(){return s})),i.d(t,"i",(function(){return r})),i.d(t,"j",(function(){return o})),i.d(t,"n",(function(){return c})),i.d(t,"b",(function(){return u})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return l})),i.d(t,"k",(function(){return h})),i.d(t,"c",(function(){return f})),i.d(t,"a",(function(){return g})),i.d(t,"f",(function(){return p})),i.d(t,"h",(function(){return v})),i.d(t,"g",(function(){return m}));var n=i("b775");function a(e){return Object(n["a"])({url:"/order/getOrderDetail",method:"GET",params:e})}function s(e){return Object(n["a"])({url:"/gcywVehicleRequest/dispatchListInfoH5",method:"GET",params:e})}function r(e){return Object(n["a"])({url:"/gcywVehicleRequestLog/list",method:"GET",params:e})}function o(e){return Object(n["a"])({url:"/gcywVehicleRequest/cancelVehicleRequest",method:"POST",data:e})}function c(e){return Object(n["a"])({url:"/gcywVehicleRequest/activiti/reject",method:"POST",data:e})}function u(e){return Object(n["a"])({url:"/activiti/assigneeList",method:"post",data:e})}function d(e){return Object(n["a"])({url:"/gcywVehicleRequest/activiti/complete",method:"POST",data:e})}function l(e){return Object(n["a"])({url:"/gcywVehicleRequest/listPage",method:"GET",params:e})}function h(e){return Object(n["a"])({url:"/gcywVehicleRequest/confirmVehicleRequest",method:"POST",data:e})}function f(e){return Object(n["a"])({url:"/gcywVehicleRequest/addVehicleRequest",method:"post",data:e})}function g(e){return Object(n["a"])({url:"/activiti/assigneeListByType",method:"get",params:e})}function p(e){return Object(n["a"])({url:"/gcywVehicleRequest/dispatchList",method:"get",params:e})}function v(e){return Object(n["a"])({url:"/gcywVehicleRequestLog/list",method:"get",params:e})}function m(e){return Object(n["a"])({url:"/gcywVehicleRequest/listPageForH5",method:"get",params:e})}},fd99:function(e,t,i){"use strict";t["a"]={created:function(){this.$options.name||console.warn("缓存页面失败！没有设置组件名！"),this.$store.commit("keepThisPage",this.$options.name)},beforeDestroy:function(){}}},fe58:function(e,t,i){"use strict";i("4df3")}}]);