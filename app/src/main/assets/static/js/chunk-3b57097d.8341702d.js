(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b57097d"],{"26c3":function(t,e,a){"use strict";a.d(e,"c",(function(){return r})),a.d(e,"d",(function(){return i})),a.d(e,"b",(function(){return s})),a.d(e,"e",(function(){return o})),a.d(e,"i",(function(){return c})),a.d(e,"g",(function(){return l})),a.d(e,"f",(function(){return u})),a.d(e,"h",(function(){return d})),a.d(e,"j",(function(){return f})),a.d(e,"a",(function(){return h})),a.d(e,"k",(function(){return p}));var n=a("b775");function r(t){return Object(n["a"])({url:"/gcywVehicleReqAssignmennt/listPage",method:"GET",params:t})}function i(t){return Object(n["a"])({url:"/gcywVehicleReqAssignmennt/listPage",method:"GET",params:t})}function s(t){return Object(n["a"])({url:"/gcywVehicleReqAssignmennt/driving/checkDriving",method:"GET",params:t})}function o(t){return Object(n["a"])({url:"/gcywVehicleReqAssignmennt/cancelOrder",method:"get",params:t})}function c(t){return Object(n["a"])({url:"/gcywVehicleReqAssignmennt/takeOrder",method:"get",params:t})}function l(t){return Object(n["a"])({url:"/gcywVehicleReqAssignmennt/remind",method:"get",params:t})}function u(t){return Object(n["a"])({url:"/gcywVehicleReqAssignmennt/driving",method:"post",data:t})}function d(t){return Object(n["a"])({url:"/gcywVehicleReqAssignmennt/returning",method:"post",data:t})}function f(t){return Object(n["a"])({url:"/minio/upload",method:"post",data:t})}function h(t){return Object(n["a"])({url:"/vehicleInfo/isRestriction",method:"get",params:t})}function p(t){return Object(n["a"])({url:"/vehicleInfo/detail/".concat(t),method:"get"})}},"5b81":function(t,e,a){"use strict";var n=a("23e7"),r=a("c65b"),i=a("e330"),s=a("1d80"),o=a("1626"),c=a("7234"),l=a("44e7"),u=a("577e"),d=a("dc4a"),f=a("90d8"),h=a("0cb2"),p=a("b622"),m=a("c430"),g=p("replace"),b=TypeError,v=i("".indexOf),C=i("".replace),y=i("".slice),D=Math.max;n({target:"String",proto:!0},{replaceAll:function(t,e){var a,n,i,p,w,k,O,x,j,$,q=s(this),L=0,R="";if(!c(t)){if(a=l(t),a&&(n=u(s(f(t))),!~v(n,"g")))throw new b("`.replaceAll` does not allow non-global regexes");if(i=d(t,g),i)return r(i,t,q,e);if(m&&a)return C(u(q),t,e)}p=u(q),w=u(t),k=o(e),k||(e=u(e)),O=w.length,x=D(1,O),j=v(p,w);while(-1!==j)$=k?u(e(w,j,p)):h(w,p,j,[],void 0,e),R+=y(p,L,j)+$,L=j+O,j=j+x>p.length?-1:v(p,w,j+x);return L<p.length&&(R+=y(p,L)),R}})},"7ab5":function(t,e,a){},"7ffd":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main-container"},[e("general-order-detail",{attrs:{orderDetail:t.orderDetail,approveLogList:t.approveLogList,isDrivingDetail:!0,hasButton:"1"==t.orderDetail.status||"2"==t.orderDetail.status||"4"==t.orderDetail.status}}),"1"==t.orderDetail.status?e("div",{staticClass:"default-button-container-two"},[e("van-button",{attrs:{block:"",type:"default",round:""},on:{click:function(e){return t.handleReject()}}},[t._v("拒绝接单")]),e("van-button",{attrs:{block:"",type:"info",round:""},on:{click:function(e){return t.handleConfirmOrder()}}},[t._v("确认接单")])],1):t._e(),"2"==t.orderDetail.status?e("div",{staticClass:"default-button-container-one"},[e("van-button",{attrs:{block:"",type:"info",round:""},on:{click:function(e){return t.handleDispatch()}}},[t._v("确认出车")])],1):t._e(),"4"==t.orderDetail.status?e("div",{staticClass:"default-button-container-two"},[e("van-button",{attrs:{block:"",type:"default",round:""},on:{click:function(e){return t.handleTip()}}},[t._v("接车提醒")]),e("van-button",{attrs:{block:"",type:"info",round:""},on:{click:function(e){return t.handleReturn()}}},[t._v("确认还车")])],1):t._e(),e("van-popup",{attrs:{position:"bottom"},on:{close:function(e){return t.handleDispatchClose()}},model:{value:t.dispatchCar,callback:function(e){t.dispatchCar=e},expression:"dispatchCar"}},[e("van-form",{staticClass:"form-scroll",attrs:{"validate-first":""},on:{submit:t.drivingConfirmDriving}},[e("van-field",{attrs:{label:"出车里程：",center:"",readonly:""},scopedSlots:t._u([{key:"input",fn:function(){return[e("span",{staticStyle:{color:"red"}},[t._v(t._s(t.beginMiles))]),e("span",{staticStyle:{"margin-left":"10px"}},[t._v("千米")])]},proxy:!0}])}),e("van-field",{staticStyle:{"padding-left":"10px"},attrs:{label:"",center:"",readonly:""},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-icon",{staticClass:"warnning",attrs:{name:"info-o"}}),e("p",{staticStyle:{"margin-left":"5px"}},[t._v("出车里程和表显里程不符？"),e("a",{staticStyle:{color:"#1890ff","text-decoration":"underline"},attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.handleCatchClick()}}},[t._v("异常报告")])])]},proxy:!0}])}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowCatch,expression:"isShowCatch"}]},[e("van-field",{staticClass:"form-textarea",attrs:{label:"异常原因：",required:t.isShowCatch,name:"message",rows:"1",autosize:"",type:"textarea",maxlength:"200",placeholder:"请输入异常原因","show-word-limit":"",rules:[{required:t.isShowCatch}]},model:{value:t.dispatchCarData.message,callback:function(e){t.$set(t.dispatchCarData,"message",e)},expression:"dispatchCarData.message"}}),e("van-field",{attrs:{label:"拍照上传　\n表显里程：",required:t.isShowCatch,rules:[{required:!1},{validator:t.validateImageUrl,message:"请上传表显里程照片!"}]},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-uploader",{attrs:{"after-read":t.afterReadDispatch,"max-count":1,"before-read":t.beforeRead,capture:""},on:{delete:function(e){return t.handleDispatchImageDelete()}},model:{value:t.dispatchFileList,callback:function(e){t.dispatchFileList=e},expression:"dispatchFileList"}})]},proxy:!0}])})],1),e("div",{staticClass:"form-button"},[e("van-button",{attrs:{block:"",type:"info",round:"","native-type":"submit"}},[t._v("确认出车")])],1)],1)],1),e("van-popup",{attrs:{position:"bottom"},on:{close:function(e){return t.handleTransferClose()}},model:{value:t.transferCar,callback:function(e){t.transferCar=e},expression:"transferCar"}},[e("van-form",{staticClass:"form-scroll",attrs:{"validate-first":""},on:{submit:t.drivingreturnCar}},[e("van-field",{attrs:{required:"",label:"出车里程：",center:"",disabled:!0,rules:[{required:!0},{validator:t.asyncValidate,message:"还车里程必须大于出车里程!"}],name:"beginMiles"},scopedSlots:t._u([{key:"extra",fn:function(){return[e("span",[t._v("千米")])]},proxy:!0}]),model:{value:t.transferCarData.beginMiles,callback:function(e){t.$set(t.transferCarData,"beginMiles",e)},expression:"transferCarData.beginMiles"}}),e("van-field",{attrs:{required:"",label:"还车里程：",center:"",placeholder:"请输入当前表显里程数",rules:[{required:!0},{validator:t.asyncValidate,message:"还车里程必须大于出车里程!"}],name:"endMiles"},on:{input:function(e){return t.handleNumberLimit(t.transferCarData,"endMiles")}},scopedSlots:t._u([{key:"extra",fn:function(){return[e("span",[t._v("千米")])]},proxy:!0}]),model:{value:t.transferCarData.endMiles,callback:function(e){t.$set(t.transferCarData,"endMiles",e)},expression:"transferCarData.endMiles"}}),e("van-field",{attrs:{required:"",label:"等待时长：",center:"",placeholder:"请输入当前等待时长数",rules:[{required:!0}],name:"waitTimes"},on:{input:function(e){return t.handleNumberLimit(t.waitTimes,"beginMiles")}},scopedSlots:t._u([{key:"extra",fn:function(){return[e("span",[t._v("小时")])]},proxy:!0}]),model:{value:t.transferCarData.waitTimes,callback:function(e){t.$set(t.transferCarData,"waitTimes",e)},expression:"transferCarData.waitTimes"}}),e("van-field",{attrs:{required:"",label:"路桥费：",center:"",placeholder:"请输入路桥费",rules:[{required:!0}],name:"etcCost"},on:{input:function(e){return t.handleNumberLimit(t.waitTimes,"etcCost")}},scopedSlots:t._u([{key:"extra",fn:function(){return[e("span",[t._v("元")])]},proxy:!0}]),model:{value:t.transferCarData.etcCost,callback:function(e){t.$set(t.transferCarData,"etcCost",e)},expression:"transferCarData.etcCost"}}),e("van-field",{attrs:{required:"",label:"加油费：",center:"",placeholder:"请输入加油费",rules:[{required:!0}],name:"oilCost"},on:{input:function(e){return t.handleNumberLimit(t.waitTimes,"oilCost")}},scopedSlots:t._u([{key:"extra",fn:function(){return[e("span",[t._v("元")])]},proxy:!0}]),model:{value:t.transferCarData.oilCost,callback:function(e){t.$set(t.transferCarData,"oilCost",e)},expression:"transferCarData.oilCost"}}),e("van-field",{attrs:{required:"",label:"其他费：",center:"",placeholder:"请输入其他费",rules:[{required:!0}],name:"otherCost"},on:{input:function(e){return t.handleNumberLimit(t.waitTimes,"otherCost")}},scopedSlots:t._u([{key:"extra",fn:function(){return[e("span",[t._v("元")])]},proxy:!0}]),model:{value:t.transferCarData.otherCost,callback:function(e){t.$set(t.transferCarData,"otherCost",e)},expression:"transferCarData.otherCost"}}),e("van-field",{attrs:{required:"",label:"停车费：",center:"",placeholder:"请输入停车费",rules:[{required:!0}],name:"parkCost"},on:{input:function(e){return t.handleNumberLimit(t.waitTimes,"parkCost")}},scopedSlots:t._u([{key:"extra",fn:function(){return[e("span",[t._v("元")])]},proxy:!0}]),model:{value:t.transferCarData.parkCost,callback:function(e){t.$set(t.transferCarData,"parkCost",e)},expression:"transferCarData.parkCost"}}),e("van-field",{staticClass:"form-textarea",attrs:{label:"行程描述：",name:"remark",rows:"1",autosize:"",type:"textarea",maxlength:"50",placeholder:"请输入行程描述","show-word-limit":""},model:{value:t.transferCarData.remark,callback:function(e){t.$set(t.transferCarData,"remark",e)},expression:"transferCarData.remark"}}),e("van-field",{attrs:{label:"还车里程　\n拍照上传：",readonly:""},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-uploader",{attrs:{"after-read":t.afterReadTransfer,"max-count":1,"before-read":t.beforeRead,capture:""},on:{delete:function(e){return t.handleTransferImageDelete()}},model:{value:t.transferFileList,callback:function(e){t.transferFileList=e},expression:"transferFileList"}})]},proxy:!0}])}),e("div",{staticClass:"form-button"},[e("van-button",{attrs:{block:"",type:"info",round:"","native-type":"submit"}},[t._v("确认还车")])],1)],1)],1)],1)},r=[],i=a("c7eb"),s=a("1da1"),o=(a("14d9"),a("a434"),a("b680"),a("d3b7"),a("acd8"),a("8a60")),c=a("f8b7"),l=a("26c3"),u=a("986e"),d=a("fd99"),f=a("ed08"),h={name:"DrivingDetails",mixins:[d["a"]],components:{GeneralOrderDetail:o["a"]},data:function(){return{handleNumberLimit:f["c"],id:"",assignmentId:"",orderDetail:{},approveLogList:[],transferCar:!1,dispatchCar:!1,isShowCatch:!1,beginMiles:"",transferCarData:{beginMiles:"0",endMiles:"0",waitTimes:"0",etcCost:"0",oilCost:"0",otherCost:"0",parkCost:"0",remark:"",imageUrl:"",images:[]},dispatchCarData:{message:"",imageUrl:"",images:[]},transferFileList:[],dispatchFileList:[]}},created:function(){this.id=this.$route.params.id,this.assignmentId=this.$route.params.assignmentId,this.getOrderDetail(),this.getOrderApprovalLog(),u["a"].$off("cancelOrderConfirm"),u["a"].$on("cancelOrderConfirm",function(t){this.requestCancelOrder(t)}.bind(this))},activated:function(){this.$route.params.refresh&&(this.getOrderDetail(),this.getOrderApprovalLog())},methods:{getOrderDetail:function(){var t=this,e=this.$toast.loading({duration:0,message:"加载中..",forbidClick:!0}),a={assignmentId:this.assignmentId};Object(l["c"])(a).then((function(e){var a=e.data;t.orderDetail=a.list[0],t.getVehicleInfo()})).catch((function(){})).finally((function(){e.clear()}))},getVehicleInfo:function(){var t=this,e=this.$toast.loading({duration:0,message:"加载中..",forbidClick:!0});Object(l["k"])(this.orderDetail.vinNumber).then((function(e){var a=e.data;a.startMiles?t.beginMiles=a.startMiles:t.beginMiles=0})).catch((function(t){})).finally((function(){e.clear()}))},getOrderApprovalLog:function(){var t=this,e=this.$toast.loading({duration:0,message:"加载中..",forbidClick:!0}),a={reqId:this.id};Object(c["h"])(a).then((function(e){var a=e.data;t.approveLogList=a})).catch((function(){})).finally((function(){e.clear()}))},handleReject:function(){var t=this;this.$dialog.confirm({title:"提示",message:"是否拒绝接单?"}).then((function(){t.requestReject()})).catch((function(){}))},requestReject:function(){var t=this,e=this.$toast.loading({duration:0,message:"正在提交..",forbidClick:!0}),a={assignmentId:this.assignmentId};Object(l["e"])(a).then((function(e){var a=e.message;t.$notify({type:"success",message:a}),t.$router.push({name:"DrivingList",params:{refresh:!0}})})).catch((function(e){t.$toast.fail("提交失败!")})).finally((function(){e.clear()}))},handleConfirmOrder:function(){var t=this;this.$dialog.confirm({title:"提示",message:"是否确认接单?"}).then((function(){t.requestConfirmOrder()})).catch((function(){}))},requestConfirmOrder:function(){var t=this,e=this.$toast.loading({duration:0,message:"正在提交..",forbidClick:!0}),a={assignmentId:this.assignmentId};Object(l["i"])(a).then((function(e){var a=e.message;t.$notify({type:"success",message:a}),t.$router.push({name:"DrivingList",params:{refresh:!0}})})).catch((function(e){t.$toast.fail("提交失败!")})).finally((function(){e.clear()}))},handleTip:function(){var t=this;this.$dialog.confirm({title:"提示",message:"是否接车提醒?"}).then((function(){t.requestTip()})).catch((function(){}))},requestTip:function(){var t=this,e=this.$toast.loading({duration:0,message:"正在取消..",forbidClick:!0}),a={assignmentId:this.assignmentId};Object(l["g"])(a).then((function(e){var a=e.message;t.$notify({type:"success",message:a})})).catch((function(e){t.$toast.fail("取消失败!")})).finally((function(){e.clear()}))},handleReturn:function(){this.transferCar=!0,this.orderDetail.beginMiles&&(this.transferCarData.beginMiles=this.orderDetail.beginMiles)},asyncValidate:function(){var t=1*this.transferCarData.endMiles,e=1*this.transferCarData.beginMiles;return t>e},beforeRead:function(t){var e="image/jpeg"===t.type,a="image/png"===t.type,n=t.size/1024/1024<2;return e||a?!!n||(this.$notify({type:"warning",message:"上传图片大小不能超过 2MB!"}),!1):(this.$notify({type:"warning",message:"上传图片只能是 JPG 或 PNG 格式!"}),!1)},afterReadTransfer:function(t){var e=this,a=new FormData;a.append("file",t.file),a.append("type","4"),this.transferFileList[0].status="uploading",this.transferFileList[0].message="上传中...",Object(l["j"])(a).then((function(t){var a=t.data;e.$notify({type:"success",message:"上传图片成功"}),e.transferFileList[0].status="",e.transferFileList[0].message="",e.transferFileList[0].url=a.url,e.transferCarData.imageUrl=a.url,e.transferCarData.images[0]=a})).catch((function(t){e.$notify({type:"warning",message:"上传图片失败"})}))},handleTransferImageDelete:function(){this.transferCarData.imageUrl="",this.transferCarData.images.splice(0,1)},handleTransferClose:function(){this.transferCarData=this.$options.data.call(this).transferCarData,this.transferFileList=[]},drivingreturnCar:function(){var t=this,e=parseFloat(this.transferCarData.endMiles),a=parseFloat(this.transferCarData.beginMiles),n=(e-a).toFixed(2),r="";r=e-a>100?"<div style='line-height:10px'><p style='text-align:center;'>请确认还车里程为<span style='color:blue;'>"+this.transferCarData.endMiles+"</span>KM,</p>\n                    <p>行驶里程为<span style='color:red;'>"+n+"</span>KM,</p>\n                    <p>是否正确？</p></div>":"<div style='line-height:10px'><p style='text-align:center;'>请确认还车里程为<span style='color:blue;'>"+this.transferCarData.endMiles+"</span>KM,</p>\n                    <p>行驶里程为<span style='color:green;'>"+n+"</span>KM,</p>\n                    <p>是否正确？</p></div>",this.$dialog.confirm({title:"确认信息",message:r,confirmButtonText:"是",cancelButtonText:"否"}).then((function(){var e=t.$toast.loading({duration:0,message:"还车中..",forbidClick:!0});Object(l["h"])(Object.assign({},t.transferCarData,{id:t.assignmentId})).then((function(e){var a=e.message;t.$notify({type:"success",message:a}),t.$router.push({name:"DrivingSuccess",params:{id:t.id,assignmentId:t.assignmentId}})})).catch((function(e){t.$toast.fail("提交失败!")})).finally((function(){t.transferCar=!1,e.clear()}))})).catch((function(){}))},handleDispatch:function(){this.dispatchCar=!0},validateImageUrl:function(){return!this.isShowCatch||this.dispatchCarData.images.length>0},afterReadDispatch:function(t){var e=this,a=new FormData;a.append("file",t.file),a.append("type","3"),this.dispatchFileList[0].status="uploading",this.dispatchFileList[0].message="上传中...",Object(l["j"])(a).then((function(t){var a=t.data;e.$notify({type:"success",message:"上传图片成功"}),e.dispatchFileList[0].status="",e.dispatchFileList[0].message="",e.dispatchFileList[0].url=a.url,e.dispatchCarData.imageUrl=a.url,e.dispatchCarData.images[0]=a})).catch((function(t){e.$notify({type:"warning",message:"上传图片失败"})}))},handleDispatchImageDelete:function(){this.dispatchCarData.imageUrl="",this.dispatchCarData.images.splice(0,1)},handleDispatchClose:function(){this.isShowCatch=!1,this.dispatchCarData=this.$options.data.call(this).dispatchCarData,this.dispatchFileList=[]},handleCatchClick:function(){this.isShowCatch=!this.isShowCatch},drivingConfirmDriving:function(){var t=this;return Object(s["a"])(Object(i["a"])().mark((function e(){var a;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.checkDriving({vinNumber:t.orderDetail.vinNumber});case 2:a=e.sent,a&&t.$dialog.confirm({title:"提示",message:"是否要确认出车?"}).then((function(){t.requestDrivingConfirm()})).catch((function(){}));case 4:case"end":return e.stop()}}),e)})))()},requestDrivingConfirm:function(){var t=this,e=this.$toast.loading({duration:0,message:"出车中..",forbidClick:!0});Object(l["f"])(Object.assign({},this.dispatchCarData,{id:this.assignmentId})).then((function(e){var a=e.message;t.$notify({type:"success",message:a}),t.$router.push({name:"DrivingList",params:{refresh:!0}})})).catch((function(){t.$toast.fail("提交失败!")})).finally((function(){e.clear(),t.dispatchCar=!1}))},checkDriving:function(t){return new Promise((function(e,a){Object(l["b"])(t).then((function(t){var a=t.data;e(a)}))}))}}},p=h,m=(a("cbd87"),a("2877")),g=Object(m["a"])(p,n,r,!1,null,"6c6752f8",null);e["default"]=g.exports},"986e":function(t,e,a){"use strict";var n=a("2b0e"),r=new n["d"]({});e["a"]=r},cbd87:function(t,e,a){"use strict";a("7ab5")},f8b7:function(t,e,a){"use strict";a.d(e,"l",(function(){return r})),a.d(e,"m",(function(){return i})),a.d(e,"i",(function(){return s})),a.d(e,"j",(function(){return o})),a.d(e,"n",(function(){return c})),a.d(e,"b",(function(){return l})),a.d(e,"d",(function(){return u})),a.d(e,"e",(function(){return d})),a.d(e,"k",(function(){return f})),a.d(e,"c",(function(){return h})),a.d(e,"a",(function(){return p})),a.d(e,"f",(function(){return m})),a.d(e,"h",(function(){return g})),a.d(e,"g",(function(){return b}));var n=a("b775");function r(t){return Object(n["a"])({url:"/order/getOrderDetail",method:"GET",params:t})}function i(t){return Object(n["a"])({url:"/gcywVehicleRequest/dispatchListInfoH5",method:"GET",params:t})}function s(t){return Object(n["a"])({url:"/gcywVehicleRequestLog/list",method:"GET",params:t})}function o(t){return Object(n["a"])({url:"/gcywVehicleRequest/cancelVehicleRequest",method:"POST",data:t})}function c(t){return Object(n["a"])({url:"/gcywVehicleRequest/activiti/reject",method:"POST",data:t})}function l(t){return Object(n["a"])({url:"/activiti/assigneeList",method:"post",data:t})}function u(t){return Object(n["a"])({url:"/gcywVehicleRequest/activiti/complete",method:"POST",data:t})}function d(t){return Object(n["a"])({url:"/gcywVehicleRequest/listPage",method:"GET",params:t})}function f(t){return Object(n["a"])({url:"/gcywVehicleRequest/confirmVehicleRequest",method:"POST",data:t})}function h(t){return Object(n["a"])({url:"/gcywVehicleRequest/addVehicleRequest",method:"post",data:t})}function p(t){return Object(n["a"])({url:"/activiti/assigneeListByType",method:"get",params:t})}function m(t){return Object(n["a"])({url:"/gcywVehicleRequest/dispatchList",method:"get",params:t})}function g(t){return Object(n["a"])({url:"/gcywVehicleRequestLog/list",method:"get",params:t})}function b(t){return Object(n["a"])({url:"/gcywVehicleRequest/listPageForH5",method:"get",params:t})}},fd99:function(t,e,a){"use strict";e["a"]={created:function(){this.$options.name||console.warn("缓存页面失败！没有设置组件名！"),this.$store.commit("keepThisPage",this.$options.name)},beforeDestroy:function(){}}}}]);